# 生成作用素

別名：Q行列、推移率行列、英語ではgenerator
ざっくり言えば生成作用素関数を$t=0$で微分したもの
ある瞬間から次の瞬間に推移しようとしたときに、どこに推移するのかの程度を表している。だから「推移率」

$P(t)$を状態空間$\mathcal S$上の推移確率行列関数として、$P(t)$が$t=0$で連続であるとする。つまり、
$$\lim_{t\downarrow 0} P(t)=P(0)=I$$
をみたすということ。この仮定のうえで
$$q_i = \lim_{t\downarrow 0}\frac{1-p_{i,i}(t)}{t}\in[0,\infty]$$
と、$i\neq j$に対して
$$q_{i,j}=\lim_{t\downarrow 0}\frac{p_{i,j}(t)}t\in[0,\infty)$$
が成り立つ。これを用いて、$(i,j)$成分を
$$q_{i,j}=\begin{cases}-q_i & i=j \\ q_{i,j} & i\neq j\end{cases}$$
と定義して作れる行列をマルコフ連鎖の**生成作用素**（または推移率行列）という。各成分$q_{i,j}$のことを**推移率**という。

生成作用素が存在すること（つまり極限が適当な値に収まること）を示すのはあんまり簡単じゃない。証明のために劣加法的関数定理という定理を使うことになる。

## もっとシンプルに

上の定義だとまどろっこしく$q_i$を仲介していたけど、もっとシンプルに
$$Q=\lim_{t\downarrow 0} \frac{P(t)-P(0)}t =\lim_{t\downarrow 0}\frac{P(t)-I}t$$
と書くこともできる。これは成分ごとに書くと、
$$q_{i,j}=\lim_{t\downarrow 0}\frac{p_{i,j} - \delta_{ij}}t$$
となる。この式を見れば明らかなように、
$$\begin{cases} p_{ij}<\delta_{ij} & i=j \\ p_{ij}>\delta_{ij} & i\neq j\end{cases}$$
などとなるはず。このことから、
$$\begin{cases}q_{ij}<0 & i=j \\ q_{ij} > 0 & i\neq j\end{cases}$$
であることが察せられる。（厳密な議論ではないと思うけど...）つまり**対角成分は負だけど、非対角成分は正になる**。

## 生成作用素による状態の分類

$Q$を生成作用素とする。$q_i = -q_{i,i}$とおくと

- $q_i <\infty$のとき状態$i$は**安定である**という
  - 特に、$q_i=0$であるとき状態$i$は**吸収状態**である
- $q_i=\infty$のとこ状態$i$は**瞬間的である**という

これは「状態の分類」だが、これを拡張してマルコフ連鎖そのものも分類できる。

- $\forall i,\;q_i <\infty$のとき、そのマルコフ連鎖は**安定**である
- $\forall i,\; q_i =\sum_{j\in\mathcal S\setminus \{ i\}}q_{i,j}$のとき、そのマルコフ連鎖は**保存的**である
  - この条件は$1$をすべての成分が1であるベクトルとして$Q1=0$と書き換えられる

## 滞在時間との関係

生成作用素$Q$の対角成分を$q_i = -q_{ii}$とおく。

$q_i$は状態$i$の滞在時間がパラメータ$q_i$の指数分布に従っていることを表している。つまり、
$$P(\tau(0)>u\mid X(0)=i)=e^{-q_i u}$$
が成り立つ。

## 隠れマルコフ連鎖との関係

隠れマルコフ連鎖とは、状態が変化した瞬間だけを考えて、**滞在時間を無視したようなマルコフ連鎖**のこと。つまり、**状態がどのように変化したかだけを考える**。

形式的に定義すると、n回目の状態遷移が起こるまでの時刻を$\tau_n$とおいて、
$$Z_n = X(\tau_n)$$
で定義される確率過程$Z_n$のことを**隠れマルコフ連鎖**という。

この隠れマルコフ連鎖について、**生成作用素から推移確率行列が求まる**。実際に$q_i\neq 0$のときに
$$p_{ij} = \frac{q_{ij}}{q_i}\quad (i\neq j)$$
$$p_{ii} = \begin{cases}1 &q_i=0\\ 0 & q_i\neq 0\end{cases}$$
と置くことで隠れマルコフ連鎖の推移確率行列が求まる。

## 生成作用素に含まれている情報

上2つで見た

- 滞在時間の分布の情報
- 隠れマルコフ連鎖の情報

が生成作用素に含まれているが、**連続時間マルコフ連鎖はこの2つの情報に分割できる**とも考えられる。

## コルモゴロフの方程式

生成作用素から推移確率行列関数をつくることができる。そのために必要になる方程式が**コルモゴロフの後退方程式**と**コルモゴロフの前進方程式**である。
統計物理ではマスター方程式として知られているもの

生成作用素を定義できるように$P(t)$が$t=0$で連続であるとする。さらに、生成作用素が安定かつ保存的であるとする。このとき、
$$\frac{d}{dt}P(t) = QP(t)$$
が成り立つ。なお、左辺の行列を微分している部分は成分ごとに微分しているということ。これが**コルモゴロフの後退方程式**である。

さらに仮定を強めて、$q_k = -q_{k,k}$として
$$\sum_{k\in\mathcal S}p_{ik}(t)q_k<\infty$$
が成り立つという仮定をおくと、
$$\frac d{dt}P(t) = P(t)Q$$
が成り立つ。これが**コルモゴロフの前進方程式**である。

基本的には制約的にも使いやすいコルモゴロフの後退方程式を使うことになると思う。

### コルモゴロフの後退方程式の直感的な証明

厳密な議論ではないと思うけど、ざっくりと正当化しようと思えば、チャップマンコルモゴロフの公式から
$$P(t+h)-P(t) = P(h)P(t)-P(t)=(P(h)-I)P(t)$$
となるので、
$$Q = \lim_{t\downarrow 0}\frac{P(t)-I}t$$
から、
$$\lim_{h\to 0}\frac{P(t+h)-P(t)}h = \lim_{h\to 0}\frac{P(h)-I}hP(t)=QP(t)$$
となる。よって、
$$\frac{d}{dt}P(t) 0= QP(t)$$
となる。

### 方程式を解いて得られる解

$Q$が[一様化](./uniformization.md)可能ならば、つまり、
$$\sup_{i\in\mathcal S} |q_{i,i}|<\infty$$
ならば、初期条件$P(0)= I$を持つような解は
$$P(t)=e^{tQ}$$
と一意的に求まる。行列を普通の数のように扱って微分方程式を解けば納得はできる。
