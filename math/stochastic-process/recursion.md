# 再帰性

最初の状態に帰ってくるまでの時間に関する性質

まずは、「帰って来るまでの時間」を定義する

## 再帰時間

確率変数$T_i$を
$$T_i =\inf \{n\in \mathbb N\mid X_n = i\},\quad i \in\mathcal S$$
と定める。このとき$T_i$を、状態$i\in\mathcal S$への**再帰時間**という。

重要なこととして、再帰時間は**確率変数**である。これは、状態$i$に帰って来る道筋は確率的に定まるので当然のことではある。

## 再帰的・一時的

このように定めた再帰時間を使うことで、マルコフ連鎖を様々に分類できる。

状態$i\in\mathcal S$に対して
$$P(T_i<\infty\mid X_0=i)=1$$
であるとき、**再帰的**であるという。
そうでないとき、つまり
$$P(T_i<\infty\mid X_0=i)<1$$
であるとき、**一時的**であるという。

「一時的」という名前がついているが、必ずしも帰ってこないということではない。**帰ってこない可能性があるとき一時的**という。

再帰的ならば何度でも戻ってくるが、一時的なら**いずれ戻ってこなくなる**（戻ってこない可能性があるから）

### 判定法

$$\sum^{\infty}_{n=1}p^{(n)}_{i,i}$$
が、

- 収束するとき：一時的
- 発散するとき：再帰的
を判定できる。

これが収束してしまうということは、$n$が大きくなるにつれて$p_{i,i}^{(n)}$がかなり0に近づいてしまうということ。つまり、**ステップ数が大きくなればなるほど帰って来る確率がさがってしまう**。なので帰ってこない可能性が出てきてしまう。

一方で発散してしまう場合、いつまでたっても$p^{(n)}_{i,i}$が一定量あるということなので、ほぼ確実に帰って来ると考えられる。

### 一時的状態への到達確率：0に収束

この判定法から、状態$j$が一時的であれば
$$\lim _{n\to\infty} p^{(n)}_{i,j}=0,\; \forall i\in\mathcal S$$
となることが分かる。証明はそんなに簡単ではない。
このことが意味することは、**一時的な状態はいつしか誰も来なくなる**ということ。自分自身に戻ってこれないだけでなくて、どこからも到達できる確率が0に収束してしまう。

このことを考えれば「一時的」というネーミングが適切であるように思える。その状態はいつしか誰も来なくなる。（一時的）

### 再帰的状態への到達確率：1に収束

状態$j$が再帰的で、$j$から$i$への到達可能であるとき、
$$f^*_{i,j}=P(T_j<\infty\mid X_0=i)=1$$
が成り立つ。つまり、$i$から$j$に有限時間で到達する確率が1であると言っている。これが意味することは、状態$j$が再帰的なら、**どんな状態からでも有限時間で帰ってこれる**ということ。（どんな状態からでもと言っているが、$j$から到達可能であることが条件）

### 連結ならすべて再帰的orすべて一時的

連結であるならそれらは、すべて再帰的であるか、すべて一時的であるかのいずれかである。
つまり、
$$i,j \in\mathcal S, \;i\leftrightarrow j$$
であるとき、

- $i,j$ともに再帰的
- $i,j$ともに一時的
のいずれかが成り立つ。

従って、既約なマルコフ連鎖については**マルコフ連鎖全体に対して性質を定めることができる**。

### 到達回数と再帰性の判定

到達回数を
$$N_j = \sum^{\infty}_{n=1} \mathbf 1_{\{X_n=j\}},\;j\in\mathcal S$$
とすると、
$$E[N_j \mid X_0 = i] = \sum^{\infty}_{n=1} P(X_n=j\mid X_0 = i) = \sum^{\infty}_{n=1}p^{(n)}_{i,j}$$
と書くことができる。
この到達回数の確率を考えることで、再帰性の判定ができる。そのために、$i$から$j$に有限時間で到達できる確率を
$$f^*_{i,j} = \sum^{\infty}_{n=1}f^{(n)}_{i,j}=P(T_j<\infty \mid X_0=i)$$
と定めて、
$$P(N_j=k\mid X_0=i) =\begin{cases}1-f^*_{i,j} & k=0 \\ f^*_{i,j}{f^*_{j,j}}^{k-1}(1-f^*_{j,j}) & k\in\mathbb N\end{cases}$$
となる。

上の式は、到達することがない場合の確率なので、
$$1-(iからjに有限時間で到達する確率)$$
となっている。下の式は、$k$回到達する確率なので
$$(有限時間でi\to j)(有限時間でj\to j)^{k-1}(いつまでもj\to jにならない)$$
となっている。$f^*_{i,i}$は

- 再帰的なら$f^*_{i,i}=1$
- 一時的なら$f^*_{i,i}<1$
なので、
- 再帰的なら$P(N_i=\infty \mid X_0=i)=\lim _{k\to\infty}f^*_{i,i}{f^*_{i,i}}^{k-1}= 1$
- 一時的なら$P(N_i=\infty\mid X_0=i) = \lim_{k\to\infty} {f^*_{i,i}}^k=0$
となる。

## 正再帰的・零再帰的

状態$i$が再帰的であるという前提で、
$$E[T_i \mid X_0=i]<\infty$$
ならば**正再帰的**であるという。
そうでないとき、つまり、
$$E[T_i\mid X_0=i] =\infty$$
となって期待値が発散するとき、**零再帰的**という。

### 連結で再帰的ならすべて正再帰的orすべて零再帰的

連結でかつ再帰的であれば、正再帰的なのか零再帰的なのか、すべての状態で共通になる。
つまり
$$i\leftrightarrow j \;\&\; i,j\in\mathcal Sが再帰的$$
ならば、

- 状態$i,j$はいずれも正再帰的
- 状態$i,j$はいずれも零再帰的
のいずれかが成り立つ。

従って、既約なマルコフ連鎖については、再帰的であれば

- すべての状態が正再帰的
- すべての状態が零再帰的
のいずれかである。すべての状態で性質が共通しているので、「正再帰的なマルコフ連鎖」や「零再帰的なマルコフ連鎖」という
